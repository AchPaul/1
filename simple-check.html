<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>–ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞</title>
<style>
body{background:#000;color:#fff;font-family:monospace;padding:15px;font-size:16px}
h1{color:#c900cc;text-align:center}
.box{background:#1a001a;border:2px solid#500078;border-radius:8px;padding:15px;margin:15px 0}
.box h3{color:#b65ee5;margin-bottom:10px}
.val{color:#4CAF50;font-weight:bold}
button{background:#500078;color:#fff;border:2px solid#c900cc;padding:12px 20px;border-radius:5px;cursor:pointer;margin:5px;font-size:16px;width:100%}
button:active{background:#c900cc}
#log{background:#000;border:1px solid#500078;padding:10px;border-radius:5px;max-height:300px;overflow-y:auto;font-size:14px;margin-top:10px}
#log div{margin-bottom:5px}
</style>
</head>
<body>
<h1>üîç –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞</h1>

<div class="box">
<h3>1. –ë—Ä–∞—É–∑–µ—Ä</h3>
<div id="ua">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
</div>

<div class="box">
<h3>2. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ SharedWorker</h3>
<div id="sw">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
</div>

<div class="box">
<h3>3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è MQTT</h3>
<div id="cfg">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
</div>

<div class="box">
<h3>4. –î–µ–π—Å—Ç–≤–∏—è</h3>
<button onclick="location.href='index.html'">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å MQTT</button>
<button onclick="location.reload()">–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å</button>
</div>

<div class="box">
<h3>5. –ñ—É—Ä–Ω–∞–ª</h3>
<div id="log"></div>
</div>

<script>
const logEl = document.getElementById('log');
let logCount = 0;

function log(msg) {
  logCount++;
  const entry = document.createElement('div');
  entry.textContent = `${logCount}. ${msg}`;
  logEl.appendChild(entry);
  console.log(msg);
}

log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');

// 1. UserAgent
const ua = navigator.userAgent;
document.getElementById('ua').innerHTML = `<span class="val">${ua}</span>`;
log(`UserAgent: ${ua}`);

// 2. SharedWorker
const swSupported = typeof SharedWorker !== 'undefined';
document.getElementById('sw').innerHTML = swSupported ? 
  '<span class="val">‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</span>' : 
  '<span style="color:#f44">‚ùå –ù–ï –ü–û–î–î–ï–†–ñ–ò–í–ê–ï–¢–°–Ø - –≤–æ—Ç –ø—Ä–æ–±–ª–µ–º–∞!</span>';
log(`SharedWorker: ${swSupported ? '–î–ê' : '–ù–ï–¢'}`);

if (!swSupported) {
  log('‚ùå –ü–†–û–ë–õ–ï–ú–ê: SharedWorker –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è!');
  log('–†–µ—à–µ–Ω–∏–µ: –æ–±–Ω–æ–≤–∏—Ç–µ Chrome –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏');
  log('–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä (Edge, Firefox)');
}

// 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
try {
  const stored = localStorage.getItem('gh_remote_cfg_v1');
  if (stored) {
    const cfg = JSON.parse(stored);
    const html = `
      <div>–•–æ—Å—Ç: <span class="val">${cfg.host}</span></div>
      <div>–ü–æ—Ä—Ç: <span class="val">${cfg.port}</span></div>
      <div>Base: <span class="val">${cfg.base}</span></div>
    `;
    document.getElementById('cfg').innerHTML = html;
    log(`–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: ${cfg.host}:${cfg.port}`);
  } else {
    document.getElementById('cfg').innerHTML = '<span style="color:#f44">‚ùå –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ</span><br><a href="index.html" style="color:#c900cc">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å</a>';
    log('‚ùå MQTT –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
  }
} catch (e) {
  document.getElementById('cfg').innerHTML = '<span style="color:#f44">‚ùå –û—à–∏–±–∫–∞: ' + e.message + '</span>';
  log('–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: ' + e.message);
}

log('‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
log('');
log('–ï—Å–ª–∏ SharedWorker –ù–ï –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è:');
log('1. –û–±–Ω–æ–≤–∏—Ç–µ Chrome (Settings ‚Üí About Chrome)');
log('2. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä');
log('3. –ò–ª–∏ —Å–æ–æ–±—â–∏—Ç–µ –º–Ω–µ - –¥–æ–±–∞–≤–ª—é fallback');
</script>
</body>
</html>
