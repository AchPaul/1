<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>GrowHub</title>
<link rel="manifest" href="manifest.json">
<style>
:root{--clr-neon:hsl(288,52%,35%);--clr-bg:hsl(295,14%,67%)}
*{margin:0;padding:0;box-sizing:border-box}
body{background:#000;color:#fff;font-family:'Courier New',monospace}
h2,h3{text-align:center;padding:0 5px}
h3{margin-bottom:20px}
.neon-buttom{background:#000;font-size:16px;text-decoration:none;color:#ebebeb;cursor:pointer;border:var(--clr-neon) .125em solid;padding:.35em 2em;border-radius:.25em;width:260px;text-align:center;box-shadow:inset 0 0 .5em 0 var(--clr-neon),0 0 .5em 0 var(--clr-neon);position:relative}
.neon-buttom:disabled{background:#3d3b3d;color:#fff;cursor:wait}
.neon-buttom::before{content:"";position:absolute;background:var(--clr-neon);top:120%;left:0;width:100%;height:100%;transform:perspective(3em)rotateX(40deg)scale(1,.35);filter:blur(1em);opacity:.7}
.neon-buttom::after{content:"";position:absolute;background:var(--clr-neon);top:0;left:0;bottom:0;right:0;box-shadow:0 0 2em .5em var(--clr-neon);opacity:0;z-index:-1;transition:opacity 100ms}
.neon-buttom:hover,.neon-buttom:focus{color:var(--clr-bg);text-shadow:none}
.neon-buttom:hover::before,.neon-buttom:focus::before,.neon-buttom:hover::after,.neon-buttom:focus::after{opacity:1}
.icon{position:relative}
.icon_btn{position:absolute;top:3px;left:10px}
.main{display:flex;margin:20px 0;justify-content:center;align-items:center;flex-direction:column;gap:25px}
.group_input{color:#fff;width:300px;padding:10px;border:2px solid var(--clr-neon);border-radius:8px;background:0 0;font-size:16px;transition:box-shadow .3s}
.group_input::placeholder{color:#fedbff;opacity:.5}
.group_input:focus{outline:0;box-shadow:0 0 10px var(--clr-neon);background:#812c82;clear:#fff}
.bord{padding:15px;border:2px solid var(--clr-neon);border-radius:12px;background:0 0;font-size:16px;text-align:center;margin-bottom:-15px}
input[type=range]{-webkit-appearance:none;appearance:none;width:100%;height:15px;border-radius:5px;background:#d3d3d3;outline:0;opacity:.7;transition:opacity .15s;margin-top:10px}
input[type=range]:hover{opacity:1}
.slider-container{margin-top:0;font-size:18px;color:#fff;margin-bottom:20px}
.slider-title{display:flex;flex-direction:column}
.slider-title div{display:flex;justify-content:space-evenly;margin-bottom:5px}
.slider-value{font-weight:700;transition:all .3s}
.slider{transition:all .3s}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:30px;height:30px;border-radius:50%;background:#bd65e5;cursor:pointer}
input[type=range]::-moz-range-thumb{width:30px;height:30px;border-radius:50%;background:#4CAF50;cursor:pointer}
header{height:75px;background:linear-gradient(135deg,#500078 0%,#28003c 100%);display:flex;align-items:center;justify-content:center;box-shadow:0 4px 15px rgba(0,0,0,.5);position:relative;z-index:100}
.header-transition{height:40px;background:linear-gradient(#370053, #000);margin-top:-10px;margin-bottom:15px}
.logo{margin-top:2px;display:inline-block}
.grow{font-size:35px;color:#fff;font-weight:700;letter-spacing:5px}
.hub{font-size:35px;color:#c900cc;font-weight:700;letter-spacing:5px;border:7px solid #c900cc;border-radius:13px;padding:2px 2px 2px 8px}
.select-dropdown{position:relative;display:inline-block;max-width:60%;transition:all ease-in-out .3s}
.select-dropdown__button{padding:10px 10px 10px 10px;background:#3f005c;color:#fff;border:3px solid #3f005c;border-radius:15px;text-align:center}
.select-dropdown__button:focus{outline:0}
.neon-divider-1{height:2px;margin:1rem 0;background:linear-gradient(90deg,transparent 10%,var(--clr-neon) 50%,transparent 90%);box-shadow:0 0 8px hsla(288,52%,35%,.4),0 0 16px hsla(288,52%,35%,.2)}
</style>
</head>
<body>
<header>
<div class="logo"><span class="grow">Grow</span><span class="hub">Hub</span></div>
</header>
<div class="header-transition"></div>
<main class="main">
<h2 style="margin-bottom:10px">Настройка гроукэпа</h2>
<div><h3 class="bord"><span data-field="profile_name">—</span></h3></div>
<section class="group_input">
<h3 style="margin-top:10px">Дневные параметры</h3>
<div class="neon-divider-1"></div>
<div class="slider-container">
<div class="slider-title"><div><span style="margin-bottom:10px">Тип освещения:</span></div></div>
<div class="select-dropdown">
<select id="inp_lig_type" class="select-dropdown__button" style="margin-left:85px">
<option value="0">Авто</option>
<option value="1">Рост</option>
<option value="2">Цветение</option>
</select>
</div>
</div>
<div class="neon-divider-1"></div>
<div class="slider-container">
<div class="slider-title"><div><span style="margin-bottom:20px">Время освещения:</span></div></div>
<span class="slider-value" data-live="lig_hours">—</span> часов в сутки
<input type="range" class="slider" min="0" max="24" id="inp_lig_hours">
</div>
<!-- <div class="neon-divider-1"></div>
<div class="slider-container">
<div class="slider-title"><div><span>Яркость:</span></div></div>
<span class="slider-value" data-live="lig_pwm">—</span>%
<input type="range" class="slider" min="0" max="100" id="inp_lig_pwm">
</div> -->
<div class="neon-divider-1"></div>
<div class="slider-container">
<div class="slider-title"><div><span>Температура:</span></div></div>
<span class="slider-value" data-live="temp_day">—</span>°C
<input type="range" class="slider" min="0" max="30" id="inp_temp_day">
</div>
<div class="neon-divider-1"></div>
<div class="slider-container">
<div class="slider-title"><div><span>Влажность почвы:</span></div></div>
<span class="slider-value" data-live="humgr_day">—</span>%
<input type="range" class="slider" min="0" max="90" id="inp_humgr_day">
</div>
<div class="neon-divider-1"></div>
<div class="slider-container">
<div class="slider-title"><div><span>Влажность воздуха:</span></div></div>
<span class="slider-value" data-live="humair_day">—</span>%
<input type="range" class="slider" min="0" max="90" id="inp_humair_day">
</div>
<div class="neon-divider-1"></div>
<div class="slider-container">
<div class="slider-title"><div><span>Проветривание (мин):</span></div></div>
<span class="slider-value" data-live="vent_day">—</span>
<input type="range" class="slider" min="0" max="180" id="inp_vent_day">
</div>
<div class="neon-divider-1"></div>
<div style="text-align:center;margin-top:20px">
<button class="neon-buttom icon" id="btn_save_day">Сохранить</button>
</div>
<div class="neon-divider-1"></div>
</section>
<!--
<section class="group_input">
<h3 style="margin-top:10px">Проветривание</h3>
<div class="neon-divider-1"></div>
<div class="slider-container">
<div class="slider-title"><div><span>Интервал (мин):</span></div></div>
<span class="slider-value" data-live="vent_interval">—</span>
<input type="range" class="slider" min="0" max="180" id="inp_vent_interval">
</div>
<div style="text-align:center;margin-top:20px">
<button class="neon-buttom icon" id="btn_save_vent">Сохранить</button>
</div>
<div class="neon-divider-1"></div>
</section>
-->
<section class="group_input">
<h3 style="margin-top:10px">Ночные параметры</h3>
<div class="neon-divider-1"></div>
<div class="slider-container">
<div class="slider-title"><div><span>Температура:</span></div></div>
<span class="slider-value" data-live="temp_night">—</span>°C
<input type="range" class="slider" min="0" max="30" id="inp_temp_night">
</div>
<div class="neon-divider-1"></div>
<div class="slider-container">
<div class="slider-title"><div><span>Влажность почвы:</span></div></div>
<span class="slider-value" data-live="humgr_night">—</span>%
<input type="range" class="slider" min="0" max="90" id="inp_humgr_night">
</div>
<div class="neon-divider-1"></div>
<div class="slider-container">
<div class="slider-title"><div><span>Влажность воздуха:</span></div></div>
<span class="slider-value" data-live="humair_night">—</span>%
<input type="range" class="slider" min="0" max="90" id="inp_humair_night">
</div>
<div class="neon-divider-1"></div>
<div class="slider-container">
<div class="slider-title"><div><span>Проветривание (мин):</span></div></div>
<span class="slider-value" data-live="vent_night">—</span>
<input type="range" class="slider" min="0" max="180" id="inp_vent_night">
</div>
<div class="neon-divider-1"></div>
<div style="text-align:center;margin-top:20px">
<button class="neon-buttom icon" id="btn_save_night">Сохранить</button>
</div>
<div class="neon-divider-1"></div>
</section>
<a class="neon-buttom icon" href="index.html">Выйти<div class="icon_btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#fff"><path d="M21 11H6.414l5.293-5.293-1.414-1.414L2.586 12l7.707 7.707 1.414-1.414L6.414 13H21z"/></svg></div></a>
</main>
<script>
// Убрано дублирование: раньше локальный скрипт и app.js оба писали значение.
// Теперь локальный код просто визуально обновляет значение, используя единственный span.
function updateSliderValue(sl){
  const container = sl.closest('.slider-container');
  if(!container) return;
  const span = container.querySelector('.slider-value');
  if(span) span.textContent = sl.value;
}
document.addEventListener('DOMContentLoaded', function(){
  document.querySelectorAll('.slider').forEach(function(sl){
    sl.addEventListener('input', function(){ updateSliderValue(sl); });
    updateSliderValue(sl);
  });
  // Остальной код сохранения параметров
  // Функция для отправки дневных параметров
  function saveDaySettings() {
    if(!window.ghPublish) return;
    
    const dayParams = [
      ['lig_type', 'inp_lig_type'],
      ['lig_hours', 'inp_lig_hours'],
      ['lig_pwm', 'inp_lig_pwm'],
      ['temp_day', 'inp_temp_day'],
      ['humgr_day', 'inp_humgr_day'],
      ['humair_day', 'inp_humair_day'],
      ['vent_day', 'inp_vent_day']
    ];
    
    dayParams.forEach(([key, id]) => {
      const el = document.getElementById(id);
      if(el) {
        window.ghPublish(key, el.value);
      }
    });
  }
  
  // Функция для отправки ночных параметров
  function saveNightSettings() {
    if(!window.ghPublish) return;
    
    const nightParams = [
      ['temp_night', 'inp_temp_night'],
      ['humgr_night', 'inp_humgr_night'],
      ['humair_night', 'inp_humair_night'],
      ['vent_night', 'inp_vent_night']
    ];
    
    nightParams.forEach(([key, id]) => {
      const el = document.getElementById(id);
      if(el) {
        window.ghPublish(key, el.value);
      }
    });
  }
  /*
  function saveVentSettings(){
    if(!window.ghPublish) return;
    const el=document.getElementById('inp_vent_interval');
    if(el) window.ghPublish('vent_interval', el.value);
  }
  */
  
  // Кнопка сохранения дневных параметров
  const btnSaveDay = document.getElementById('btn_save_day');
  if(btnSaveDay){
    btnSaveDay.addEventListener('click', function(){
      saveDaySettings();
      if(window.ghShowSaved) window.ghShowSaved(this);
    });
  }
  
  // Кнопка сохранения ночных параметров
  const btnSaveNight = document.getElementById('btn_save_night');
  if(btnSaveNight){
    btnSaveNight.addEventListener('click', function(){
      saveNightSettings();
      if(window.ghShowSaved) window.ghShowSaved(this);
    });
  }
  /*
  const btnSaveVent=document.getElementById('btn_save_vent');
  if(btnSaveVent){
    btnSaveVent.addEventListener('click', function(){
      saveVentSettings();
      if(window.ghShowSaved) window.ghShowSaved(this);
    });
  }
  */
});
</script>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script src="app.js"></script>
</body>
</html>