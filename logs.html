<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>GrowHub - –õ–æ–≥–∏</title>
<link rel="icon" type="image/svg+xml" href="favicon-plant.svg">
<link rel="manifest" href="manifest.json">
<style>
:root{--clr-neon:hsl(288,52%,35%);--clr-bg:hsl(295,14%,67%)}
*{margin:0;padding:0;box-sizing:border-box}
body{background:#000;color:#fff;font-family:'Courier New',monospace;padding-bottom:80px}
h2,h3{text-align:center;padding:0 5px}
.neon-buttom{background:#000;font-size:16px;text-decoration:none;color:#ebebeb;cursor:pointer;border:var(--clr-neon) .125em solid;padding:.35em 1.5em;border-radius:.25em;text-align:center;box-shadow:inset 0 0 .5em 0 var(--clr-neon),0 0 .5em 0 var(--clr-neon);position:relative;display:inline-block;margin:5px}
.neon-buttom:disabled{background:#3d3b3d;color:#999;cursor:not-allowed}
.neon-buttom::before{content:"";position:absolute;background:var(--clr-neon);top:120%;left:0;width:100%;height:100%;transform:perspective(3em)rotateX(40deg)scale(1,.35);filter:blur(1em);opacity:.7}
.neon-buttom::after{content:"";position:absolute;background:var(--clr-neon);top:0;left:0;bottom:0;right:0;box-shadow:0 0 2em .5em var(--clr-neon);opacity:0;z-index:-1;transition:opacity 100ms}
.neon-buttom:hover,.neon-buttom:focus{color:var(--clr-bg);text-shadow:none}
.neon-buttom:hover::before,.neon-buttom:focus::before,.neon-buttom:hover::after,.neon-buttom:focus::after{opacity:1}
.main{display:flex;margin:20px 10px;justify-content:center;align-items:center;flex-direction:column;gap:20px}
header{height:75px;background:linear-gradient(135deg,#500078 0%,#28003c 100%);display:flex;align-items:center;justify-content:center;box-shadow:0 4px 15px rgba(0,0,0,.5);position:relative;z-index:100}
.header-transition{height:40px;background:linear-gradient(#370053, #000);margin-top:-10px;margin-bottom:15px}
.logo{margin-top:2px;display:inline-block}
.grow{font-size:35px;color:#fff;font-weight:700;letter-spacing:5px}
.hub{font-size:35px;color:#c900cc;font-weight:700;letter-spacing:5px;border:7px solid #c900cc;border-radius:13px;padding:2px 2px 2px 8px}
.neon-divider-1{height:2px;margin:1rem 0;background:linear-gradient(90deg,transparent 10%,var(--clr-neon) 50%,transparent 90%);box-shadow:0 0 8px hsla(288,52%,35%,.4),0 0 16px hsla(288,52%,35%,.2)}
.status-line{font-size:12px;text-align:center;opacity:.85;margin:0 0 10px;color:#e6d8f5}
.status-line.warn{color:#ff9aa0}
.logs-container{width:95%;max-width:800px;background:rgba(61,0,92,.3);border:2px solid var(--clr-neon);border-radius:12px;padding:15px;margin:10px auto}
.log-entry{background:rgba(0,0,0,.4);border-left:3px solid;padding:8px 12px;margin:8px 0;border-radius:4px;font-size:13px;word-wrap:break-word}
.log-entry.info{border-color:#5bc0de}
.log-entry.success{border-color:#5cb85c}
.log-entry.warning{border-color:#f0ad4e}
.log-entry.error{border-color:#d9534f}
.log-entry.system{border-color:#bd65e5}
.log-time{color:#aaa;font-size:11px;margin-right:8px}
.log-icon{margin-right:5px}
.log-message{color:#fff}
.filter-bar{display:flex;flex-wrap:wrap;justify-content:center;gap:8px;margin:15px 0}
.filter-btn{padding:6px 12px;font-size:13px;cursor:pointer;background:rgba(61,0,92,.5);border:1px solid var(--clr-neon);border-radius:6px;color:#fff;transition:all .2s}
.filter-btn:hover{background:rgba(61,0,92,.8)}
.filter-btn.active{background:var(--clr-neon);color:#fff;font-weight:bold}
.controls-bar{text-align:center;margin:15px 0}
.empty-state{text-align:center;padding:40px;color:#888;font-size:14px}
.log-stats{text-align:center;font-size:12px;color:#aaa;margin:10px 0}
nav{background:linear-gradient(135deg,#28003c 0%,#1a0025 100%);padding:15px;box-shadow:0 -2px 10px rgba(0,0,0,.3);position:fixed;bottom:0;width:100%;display:flex;justify-content:space-around;z-index:1000}
nav a{color:#fff;text-decoration:none;font-size:14px;text-align:center;display:flex;flex-direction:column;align-items:center;transition:all .3s}
nav a:hover{color:var(--clr-neon);transform:scale(1.1)}
.nav-icon{font-size:20px;margin-bottom:3px}
</style>
</head>
<body>
<header>
<div class="logo"><span class="grow">Grow</span><span class="hub">Hub</span></div>
</header>
<div class="header-transition"></div>
<div class="status-line" id="status-line">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...</div>

<main class="main">
<h2 style="margin-bottom:10px">üìã –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
<div class="log-stats" id="log-stats">–ó–∞–ø–∏—Å–µ–π: 0</div>

<div class="filter-bar" id="filter-bar">
<button class="filter-btn active" data-filter="all">–í—Å–µ</button>
<button class="filter-btn" data-filter="system">–°–∏—Å—Ç–µ–º–∞</button>
<button class="filter-btn" data-filter="connection">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ</button>
<button class="filter-btn" data-filter="control">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</button>
<button class="filter-btn" data-filter="alert">–ê–ª–µ—Ä—Ç—ã</button>
</div>

<div class="controls-bar">
<button class="neon-buttom" id="btn-export">üíæ –≠–∫—Å–ø–æ—Ä—Ç</button>
<button class="neon-buttom" id="btn-clear" style="background:#5a0000">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
</div>

<div class="logs-container" id="logs-container">
<div class="empty-state">–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤...</div>
</div>
</main>

<nav>
<a href="index.html">
<div class="nav-icon">üè†</div>
<div>–ì–ª–∞–≤–Ω–∞—è</div>
</a>
<a href="state.html">
<div class="nav-icon">üìä</div>
<div>–°–æ—Å—Ç–æ—è–Ω–∏–µ</div>
</a>
<a href="settings.html">
<div class="nav-icon">‚öôÔ∏è</div>
<div>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div>
</a>
<a href="service.html">
<div class="nav-icon">üîß</div>
<div>–°–µ—Ä–≤–∏—Å</div>
</a>
</nav>

<script src="mqtt-simple.js"></script>
<script src="app.js"></script>
<script>
// Logs page specific logic
let currentFilter = 'all';

function renderLogs(){
  const container = document.getElementById('logs-container');
  const logs = window.ghGetLogs ? window.ghGetLogs() : [];
  
  if(logs.length === 0){
    container.innerHTML = '<div class="empty-state">–õ–æ–≥–∏ –ø—É—Å—Ç—ã. –°–æ–±—ã—Ç–∏—è –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å.</div>';
    updateStats(0);
    return;
  }
  
  const filtered = currentFilter === 'all' ? logs : logs.filter(l => l.category === currentFilter);
  
  if(filtered.length === 0){
    container.innerHTML = '<div class="empty-state">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏.</div>';
    updateStats(logs.length);
    return;
  }
  
  container.innerHTML = filtered.map(log => {
    const typeClass = log.type || 'info';
    const icon = getLogIcon(log.category, log.type);
    const time = formatTime(log.timestamp);
    return `<div class="log-entry ${typeClass}">
      <span class="log-time">${time}</span>
      <span class="log-icon">${icon}</span>
      <span class="log-message">${escapeHtml(log.message)}</span>
    </div>`;
  }).join('');
  
  updateStats(logs.length);
}

function updateStats(total){
  const statsEl = document.getElementById('log-stats');
  if(statsEl){
    statsEl.textContent = `–ó–∞–ø–∏—Å–µ–π: ${total}${currentFilter !== 'all' ? ' (–æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ)' : ''}`;
  }
}

function getLogIcon(category, type){
  const icons = {
    system: '‚öôÔ∏è',
    connection: 'üîå',
    control: 'üéõÔ∏è',
    alert: '‚ö†Ô∏è'
  };
  return icons[category] || '‚ÑπÔ∏è';
}

function formatTime(ts){
  const date = new Date(ts);
  const now = new Date();
  const isToday = date.toDateString() === now.toDateString();
  
  if(isToday){
    return date.toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit', second: '2-digit'});
  } else {
    return date.toLocaleString('ru-RU', {
      day: '2-digit',
      month: '2-digit',
      hour: '2-digit',
      minute: '2-digit'
    });
  }
}

function escapeHtml(text){
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// Filter buttons
document.getElementById('filter-bar').addEventListener('click', (e) => {
  if(e.target.classList.contains('filter-btn')){
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    e.target.classList.add('active');
    currentFilter = e.target.getAttribute('data-filter');
    renderLogs();
  }
});

// Export logs
document.getElementById('btn-export').addEventListener('click', () => {
  const logs = window.ghGetLogs ? window.ghGetLogs() : [];
  if(logs.length === 0){
    alert('–ù–µ—Ç –ª–æ–≥–æ–≤ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
    return;
  }
  
  const text = logs.map(l => {
    const time = new Date(l.timestamp).toISOString();
    return `[${time}] [${l.category}/${l.type}] ${l.message}`;
  }).join('\n');
  
  const blob = new Blob([text], {type: 'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `growhub-logs-${Date.now()}.txt`;
  a.click();
  URL.revokeObjectURL(url);
});

// Clear logs
document.getElementById('btn-clear').addEventListener('click', () => {
  if(confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–≥–∏? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.')){
    if(window.ghClearLogs){
      window.ghClearLogs();
      renderLogs();
    }
  }
});

// Refresh logs when page becomes visible
document.addEventListener('visibilitychange', () => {
  if(document.visibilityState === 'visible'){
    renderLogs();
  }
});

// Initial render
setTimeout(renderLogs, 500);

// Auto-refresh every 5 seconds
setInterval(renderLogs, 5000);
</script>
</body>
</html>
